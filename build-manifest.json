{
  "last_updated_by": "BE-0",
  "last_updated_at": "2026-02-10T13:37:53Z",
  "nodes": {
    "BE-0": {
      "title": "Async FastAPI backend scaffold with DB healthcheck and Alembic wiring",
      "completed_at": "2026-02-10T13:37:53Z",
      "contracts": {
        "ApiError": {
          "type": "object",
          "fields": {
            "code": {
              "type": "string",
              "nullable": false
            },
            "message": {
              "type": "string",
              "nullable": false
            },
            "details": {
              "type": "dict | list | string | null",
              "nullable": true,
              "optional": true,
              "default": null
            }
          }
        },
        "ApiErrorResponse": {
          "type": "object",
          "fields": {
            "error": {
              "type": "ApiError",
              "nullable": false
            }
          }
        },
        "HealthResponse": {
          "type": "object",
          "fields": {
            "status": {
              "type": "string",
              "nullable": false
            },
            "service": {
              "type": "string",
              "nullable": false
            },
            "db": {
              "type": "object",
              "nullable": false,
              "fields": {
                "status": {
                  "type": "string",
                  "nullable": false
                }
              }
            }
          }
        }
      },
      "schemas": {
        "sqlalchemy_models": {
          "Base": "class Base(DeclarativeBase): pass"
        },
        "database_tables": []
      },
      "files_created": [
        "app/__init__.py",
        "app/main.py",
        "app/api/__init__.py",
        "app/api/health.py",
        "app/core/__init__.py",
        "app/core/config.py",
        "app/core/constants.py",
        "app/core/errors.py",
        "app/db/__init__.py",
        "app/db/base.py",
        "app/db/session.py",
        "app/middleware/__init__.py",
        "app/middleware/rate_limit.py",
        "alembic.ini",
        "alembic/env.py",
        "alembic/README",
        "alembic/script.py.mako",
        "alembic/versions/.gitkeep",
        "pyproject.toml",
        ".env.example",
        "README.md",
        "build-manifest.json"
      ],
      "decisions": [
        "DATABASE_URL normalization is centralized in app.db.session.normalize_database_url and converts postgres:// and postgresql:// to postgresql+asyncpg:// for runtime and Alembic use.",
        "Application startup is tolerant of missing DATABASE_URL and OPENAI_API_KEY; database reachability is enforced at request time in GET /health.",
        "Error envelope standardization is applied globally via exception handlers, including Starlette HTTP exceptions (e.g. 404), to always return ApiErrorResponse on non-2xx outcomes.",
        "Canonical topics are defined as backend constants in app/core/constants.py for reuse in later phases without DB storage in Phase 0.",
        "Health DB checks use a short-lived async engine per request to keep startup lightweight and satisfy explicit DB ping contract behavior."
      ],
      "environment_variables": [
        {
          "key": "DATABASE_URL",
          "required": true,
          "description": "PostgreSQL connection URL used by /health DB ping and Alembic migrations; normalized to postgresql+asyncpg://."
        },
        {
          "key": "OPENAI_API_KEY",
          "required": false,
          "description": "Placeholder for future OpenAI integration; intentionally non-blocking during startup in Phase 0."
        },
        {
          "key": "CORS_ALLOWED_ORIGINS",
          "required": false,
          "description": "Comma-separated CORS allowlist. Defaults to http://localhost:5173,http://localhost:3000 when unset or empty."
        }
      ],
      "enums": [
        {
          "name": "CANONICAL_TOPICS",
          "values": [
            "Politics",
            "Science",
            "History",
            "Art",
            "Current Affairs"
          ],
          "layers": [
            "python_api"
          ]
        }
      ],
      "response_schemas": {
        "GET /health": {
          "200": {
            "type": "object",
            "fields": {
              "status": {
                "type": "string",
                "nullable": false,
                "literal": "ok"
              },
              "service": {
                "type": "string",
                "nullable": false,
                "literal": "five-by-backend"
              },
              "db": {
                "type": "object",
                "nullable": false,
                "fields": {
                  "status": {
                    "type": "string",
                    "nullable": false,
                    "literal": "ok"
                  }
                }
              }
            }
          },
          "503": {
            "type": "object",
            "fields": {
              "error": {
                "type": "object",
                "nullable": false,
                "fields": {
                  "code": {
                    "type": "string",
                    "nullable": false,
                    "literal": "db_unavailable"
                  },
                  "message": {
                    "type": "string",
                    "nullable": false,
                    "literal": "Database is not reachable"
                  }
                }
              }
            }
          },
          "500": {
            "type": "object",
            "fields": {
              "error": {
                "type": "object",
                "nullable": false,
                "fields": {
                  "code": {
                    "type": "string",
                    "nullable": false,
                    "literal": "internal_error"
                  },
                  "message": {
                    "type": "string",
                    "nullable": false,
                    "literal": "Unexpected server error"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
